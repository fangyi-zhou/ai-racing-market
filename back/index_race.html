<!DOCTYPE html>
<html>
<head>
  <title>Test demo - p2.js physics engine</title>
  <script src="p2.js/build/p2.js"></script>
  <script src="p2.js/demos/js/pixi.js"></script>
  <!-- <script src="p2.js/build/p2.renderer.js"></script> -->
  <!-- <link href="p2.js/demos/css/demo.css" rel="stylesheet"/> -->
  <meta name="description" content="">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
</head>
<body>
  <script>
    var num_cars = 5
    var race_cars_phys = []

    function Race_Car (vehicle, graphic) {
      this.vehicle = vehicle;
      this.box_graphic = graphic;
    }

    function updateGraphics(race_cr) {
      objects.vehicle======
    }

    function createRaceCar(world, position) {
      // Create a dynamic body for the chassis
      chassisBody = new p2.Body({
          mass: 1,
          position: position
      });
      var boxShape = new p2.Box({ width: 0.4, height: 1 });
      chassisBody.addShape(boxShape);
      world.addBody(chassisBody);

      // Create the vehicle
      vehicle = new p2.TopDownVehicle(chassisBody);

      // Add one front wheel and one back wheel - we don't actually need four :)
      frontWheel = vehicle.addWheel({
          localPosition: [0, 0.5] // front
      });
      frontWheel.setSideFriction(4);

      // Back wheel
      backWheel = vehicle.addWheel({
          localPosition: [0, -0.5] // back
      });
      backWheel.setSideFriction(3); // Less side friction on back wheel makes it easier to drift

      vehicle.addToWorld(world);
      return vehicle;
    }

    // Create the world
    var fixedTimeStep = 1 / 2;
    var world = new p2.World({
        gravity : [0,0]
    });

    // Create p2 cars
    for (i = 0; i < num_cars; i++) {
      position = [i/2, i/2]
      race_cars_phys.push(createRaceCar(world, position))
    }
    // console.log(race_cars[1])

    // Create the PIXI renderer
    var renderer = PIXI.autoDetectRenderer(600, 400),
    stage = new PIXI.Stage(0xFFFFAA);

    container = new PIXI.DisplayObjectContainer(),
    stage.addChild(container);

    document.body.appendChild(renderer.view);

    // Create the graphical representations
    graphics = new PIXI.Graphics();
    graphics.beginFill(0xFF0000);
    graphics.drawRect(10, 10, 10, 10);
    container.addChild(graphics);

    // Loop the program
    function animate() {
        requestAnimationFrame(animate);
        world.step(fixedTimeStep);

        // Update graphics
        // updateGraphics ();
        graphics.position.x += 0.1;
        graphics.position.y += 0.1;

        // console.log(world.time)
        renderer.render(stage);
    }

    // Start animation loop
    requestAnimationFrame(animate);
  </script>
</body>
</html>
