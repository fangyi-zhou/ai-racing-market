<!DOCTYPE html>
<html>
<head>
  <title>Test demo - p2.js physics engine</title>
  <script src="../../node_modules/p2/build/p2.js"></script>
  <script src="../../node_modules/p2/build/p2.renderer.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <meta name="description" content="">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
</head>
<body>
    <script>

        // Create demo application
        var app = new p2.WebGLRenderer(function(){

            // Create the physics world
            var world = new p2.World({
                gravity : [0,0]
            });

            // Register the world in the demo app
            this.setWorld(world);

            // Set stiffness of contact & constraints
            world.setGlobalStiffness(1e4);

            world.solver.iterations = 20;
            world.solver.tolerance = 0.01;
            world.islandSplit = true;

            // Enable dynamic friction. A bit more expensive than without, but gives more accurate friction
            world.solver.frictionIterations = 10;

            // Create a concave body
            concaveBody = new p2.Body({
                mass : 1,
                position:[0,2],
                type: p2.Body.KINEMATIC
            });

            var path = [[-1.0259982347488403,1.6397225856781006],[-1.2780991792678833,1.354008436203003],[-1.4041496515274048,1.2279577255249023],[-1.4965864419937134,1.068293809890747],[-1.5722168684005737,0.9086301326751709],[-1.6310402154922485,0.681739330291748],[-1.6646536588668823,0.5136721134185791],[-1.6982671022415161,0.2951846122741699],[-1.7066706418991089,0.0598905086517334],[-1.7066706418991089,-0.3938908576965332],[-1.6394437551498413,-0.5787649154663086],[-1.479779839515686,-0.7132186889648438],[-1.3285192251205444,-0.8056557178497314],[-1.1436454057693481,-0.8812859058380127],[-0.9587713479995728,-0.9401094913482666],[-0.7234772443771362,-1.024143099784851],[-0.47977983951568604,-1.0913699865341187],[-0.2949059009552002,-1.1165800094604492],[-0.11003196239471436,-1.1165800094604492],[0.16727900505065918,-1.0661598443984985],[0.46980002522468567,-0.9737229347229004],[0.7050941437482834,-0.8980926275253296],[0.8731613680720329,-0.8392691612243652],[1.083245411515236,-0.7468321323394775],[1.326942890882492,-0.6291849613189697],[1.6042538285255432,-0.46952128410339355],[1.7555143237113953,-0.3602774143218994],[1.9655983448028564,-0.17540359497070312],[2.1336655616760254,0.017873764038085938],[2.259716033935547,0.19434428215026855],[2.335346221923828,0.37921833992004395],[2.3605563640594482,0.5556888580322266],[2.2933294773101807,0.7321593761444092],[2.0832453966140747,0.9254367351531982],[1.9151781797409058,1.0010669231414795],[1.7555143237113953,1.017873764038086],[1.7050941586494446,0.8329997062683105],[1.6294639110565186,0.6481258869171143],[1.5706403851509094,0.4464452266693115],[1.5286235809326172,0.28678131103515625],[1.4445899426937103,0.10190725326538086],[1.3353462517261505,-0.06615996360778809],[1.2008924782276154,-0.21742033958435059],[1.0664386823773384,-0.3350675106048584],[0.906774815171957,-0.402294397354126],[0.7134975045919418,-0.46952128410339355],[0.5538336336612701,-0.5451514720916748],[0.3689596652984619,-0.6123783588409424],[0.17568236589431763,-0.6291849613189697],[-0.2528890371322632,-0.6291849613189697],[-0.4713764190673828,-0.6375885009765625],[-0.647847056388855,-0.620781660079956],[-0.9083511829376221,-0.4779245853424072],[-1.0091915130615234,-0.34347081184387207],[-1.0596116781234741,-0.15859675407409668],[-1.068015217781067,0.017873764038085938],[-1.068015217781067,0.4464452266693115],[-1.0428049564361572,0.6565291881561279],[-0.9923847913742065,0.8245964050292969],[-0.8831411600112915,1.0766973495483398],[-0.7738974094390869,1.236361026763916],[-0.6142336130142212,1.3624117374420166],[-0.647847056388855,1.5304787158966064]];
            concaveBody.fromPolygon(path);
            // world.addBody(concaveBody);

            // Automatically set the density of bodies that the user draws on the screen
            paths = []
            count = 1
            world.on("addBody",function(evt){
                evt.body.setDensity(1);
                paths.push(world.bodies[count].concavePath);
                // console.log("Last polygon: ", paths[count++]);
                // console.log("All polygons", paths);

                console.log('Last Polygon')
                console.log(JSON.stringify(paths[count]))
                console.log('All Polygons')
                console.log(JSON.stringify(paths))
            });

            // Car box for scale
            chassisBody = new p2.Body({
                mass: 1,
                position: [0, 0]
            });
            var boxShape = new p2.Box({ width: 0.5, height: 1 });
            chassisBody.addShape(boxShape);
            world.addBody(chassisBody);

            // Enable shape drawing
            this.setState(p2.Renderer.DRAWPOLYGON);

            // Set camera position and zoom
            this.frame(0, 1, 6, 8);
        });

    </script>
</body>
</html>
